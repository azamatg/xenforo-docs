+++
title = "post - переменная для текущего поста"
menutitle = "post"
short_desc = "Переменная для текущего поста" 
date = 2018-11-06T22:07:08+05:00
draft = "false"
layout = "single"
page_author = "me"
page_progress = "95"
show_progress = "true"
+++

{{% bq class="info" %}}`$post` - текущий пост{{% /bq %}}

Получаем дамп внутри макроса `post`:

```html
<pre>{{ dump($post) }}</pre>
```

Логика работы этой сущности - в файле `src/XF/Entity/Post.php` (см. исходные файлы XenForo 2).

## Базовые данные

| переменная | описание | пример |
| --- | --- | --- |
| `post_id` | ID текущего поста | 1 |
| `thread_id` | ID текущей ветки (к которой принадлежит этот пост) | 1 |
| `user_id` | ID юзера, создавшего пост | 1 |
| `username` | Ник юзера, создавшего пост | `admin` |
| `post_date` | Дата поста в формате UNIXTIME (целое число) | `1540891532` |
| `message` | Содержимое поста, некомпилированное (в формате BBCode), переносы строк заменены на `\n` | `test [b]message[/b]` |
| `ip_id` | ID записи в таблице IP-адресов | 2 |
| `message_state` | Статус поста | `visible` |
| `attach_count` | Количество вложений в посте | 1 |
| `position` | Позиция поста в треде (чем меньше, тем ближе к началу), 0 - первый пост | 0 |
| `likes` | Количество лайков, выданных посту | 0 |
| `like_users` | Список юзеров, выдавших лайки посту (в формате JSON) | `a:0:{}` |
| `warning_id` | ID предупреждения, если выдано (если нет, то 0) | 0 |
| `warning_message` | Текст предупреждения, если выдано (если нет, то пустое) | |
| `last_edit_date` | Дата+время редактирования поста в формате UNIXTIME | `1541183038` |
| `last_edit_user_id` | ID юзера, который редактировал пост последним | 1 |
| `edit_count` | Количество редактирований | 1 |

## Отношения (relations)

Доступ к отношениям можно получить просто, указав название отношения через точку:

```html
$post.Thread
```

### Список отношений 

| переменная | тип | описание | примечания |
| --- | --- | --- | --- |
| `Thread` | Объект | Ветка, к которой принадлежит этот пост | см. раздел `Thread` |
| `User` | Объект | Юзер - автор поста | см. раздел `User` |
| `Attachments` | `ArrayCollection` | Вложения | см. раздел `Attachments` |
| `Likes` | `FinderCollection` | Список лайков | см. раздел `Likes` |

## Методы

### Проверка прав:

- `canView()` - юзер может просматривать данный пост?
- `canEdit()` - юзер может редактировать этот пост?
- `canEditSilently()` - юзер может редактировать этот пост без уведомления о редактировании?
- `canUseInlineModeration()` - у юзера есть права на инлайн-модерацию этого поста?
- `canViewHistory()` - юзер может просматривать историю редактирования этого поста?
- `canDelete()` - юзер может удалить этот пост?
- `canUndelete()` - юзер может восстановить этот пост?
- `canApproveUnapprove()` - юзер может одобрять или не одобрять данный пост?
- `canWarn()` - юзер может вынести предупреждение этому посту?
- `canMove()` - юзер может переместить этот пост?
- `canCopy()` - юзер может копировать этот пост?
- `canMerge()` - юзер может объединить этот пост с другими?
- `canReport()` - юзер может пожаловаться на этот пост?
- `canLike()` - юзер может лайкать данный пост?
- `canCleanSpam()` - юзер может удалить этот пост как спам?
- `canSendModeratorActionAlert()` - юзер может отправить уведомление модератору на данный пост?

### Комплексные проверки:

- `isVisible()` - пост виден этому юзеру?
- `isLiked()` - юзер уже лайкнул данный пост?
- `isFirstPost()` - это первый пост в теме?
- `isLastPost()` - это последний пост в теме?
- `isUnread()` - юзер прочитал пост?
- `isAttachmentEmbedded()` - в посте есть вложения, встроенные в сообщение в виде тега `[ATTACH]`?
- `isIgnored()` - пост в игноре у юзера?