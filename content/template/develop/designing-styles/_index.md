+++
title = "Работа с файлами стилей (режим разработки)"
menutitle = "Работа с файлами стилей)"
short_desc = "Работа с файлами стилей (режим разработки)"
draft = false
layout = "single"
page_author = "official"
page_progress = "100"
show_progress = "true"
+++

В XenForo 2 добавлен новый режим разработки и правки стилей и шаблонов - `Designer Mode` (режим разработки). Это набор консольных команд, которые позволяют редактировать шаблоны в виде файлов (в файловой системе вашего сервера). Также в этом режиме доступны метаданные и различная техническая информация о шаблонах, что полезно при совместной разработке с помощью систем контроля версий (Git etc.).

(!) Это подразумевает, что у вас есть консольный доступ к серверу (по SSH) или локальная среда разработки, которая поддерживает запуск PHP-скриптов в консоли.

## Включение режима разработки

Первый шаг - включите настройку в файле `src/config.php`:

```php
$config['designer']['enabled'] = true;
```

Путь для выгрузки файлов (по умолчанию) - `src/styles`. Вы можете определить другой путь для выгрузки файлов шаблонов, задав опцию в файле `src/config.php`:

```php
$config['designer']['basePath'] = 'src/my_styles';
``` 

## Включение режима разработки для конкретного стиля

Внимание! Для каждого конкретного стиля режим разработки нужно включать отдельно. Для этого в консоли нужно выполнить соответствующую команду:

```bash
$ php cmd.php xf-designer:enable [style_id] [designer_mode_id]
```

Здесь мы выполняем команду "Разрешить режим разработки" (`xf-designer:enable`) для стиля с ID `[style_id]` и назначаем ему текстовый алиас `[designer_mode_id]`. Этот алиас будет нужен далее для работы с этим стилем, также он будет названием каталога, куда будут выгружены файлы шаблонов этого стиля (путь `[basePath]/[designer_mode_id]`).

Пример:

```bash
$ php cmd.php xf-designer:enable 2 test_style
Exporting style properties...
    0 [>---------------------------]
Style properties exported. (0.00s)
Exporting style property groups...
    0 [>---------------------------]
Style property groups exported. (0.00s)
Exporting templates...
 2/2 [============================] 100%
Templates exported. (0.02s)

Designer mode enabled for 'TestStyle' in path 'src/styles/test_style'
```

В этом примере мы включили режим разработки для стиля с ID = 2 (этот ID можно посмотреть в админпанели в списке стилей), и назначили ему алиас `test_style`. Наши шаблоны выгрузились в каталог по умолчанию (с учетом названия алиаса)- `src/styles/test_style`.

Примечание: Если в заданном каталоге уже есть файлы шаблонов, скрипт предложит два варианта:

- перезаписать существующие файлы содержимым стиля из базы данных
- сохранить существующие файлы и записать их содержимое в базу данных


## Отключение режима разработки для конкретного стиля

Чтобы ооключить режим разработки для конкретного стиля, выполните в консоли эту команду:

```bash
$ php cmd.php xf-designer:disable [designer_mode_id]
```

`[designer_mode_id]` - алиас вашего стиля, созданный при включении режима разработки для данного стиля.

По умолчанию, при отключении режима разработки все файлы шаблонов сохраняются в каталоге данного стиля. Если вы хотите также удалить эти файлы сразу при отключении режима разработки, используйте опцию `clear`:

```bash
$ php cmd.php xf-designer:disable [designer_mode_id] --clear
```

## Что конкретно будет выведено в виде файлов шаблонов?

Внимание! **В виде файлов выгружаются только те шаблоны, в которых уже есть изменения** (в которые внесены изменения через админ-панель). При этом измененные файлы родительского стиля также не будут выгружаться.

### Шаблоны

Шаблоны выгружаются в каталог `[basePath]/[designer_mode_id]/templates` с учетом типа шаблона. К примеру, публичные шаблоны типа `post_macros` будут выгружены в подкаталог `templates/public`, шаблоны админпанели в подкаталог `templates/admin` и так далее.

Файлы выгружаются с раширением `html` и доступны для редактирования в любом текстовом редакторе.

Изменения, внесенные в файл, отображаются сразу же, когда в браузере будет загружена страница, в структуре которой используется данный шаблон.

Чтобы вернуть шаблон к первоначальному виду (`revert`), просто удалите файл этого шаблона.

### Свойства шаблонов и группы свойств

Свойства шаблонов и группы свойств выгружаются в файлы формата JSON в соответствующие каталоги:

- `[basePath]/[designer_mode_id]/style_properties` - свойства шаблонов
- `[basePath]/[designer_mode_id]/style_property_groups` - группы свойств

Внимание! Эти файлы изменять не рекомендуется, потому что изменения в этих файлах не будут автоматически импортироваться (как файлы шаблонов). По сути, эти файлы нужны по большей части для отслеживания изменений в стиле через системы контроля весрий (с помощью diff, к примеру).


## Изменение конкретного шаблона

Еще раз напоминаем, что выгружаются только те шаблоны, в которых внесены изменения через админпанель. 

Когда включен режим разработки, **файл шаблона будет автоматически выгружен после первого же изменения шаблона в админпанели** (после этого с ним можно уже работать в виде файла шаблона).

Тем не менее, есть способ выгрузить конкретный шаблон в виде файла с помощью команды `touch-template`:

```bash
$ php cmd.php xf-designer:touch-template test_style public:post

Template 'public:post' modified in style 'TestStyle'
```

В этом примере мы выгрузили шаблон `post` в виде файла, не заходя в админпанель для правок данного шаблона. Файл шаблона выгрузился в каталог `templates/public`. 

Также есть возможность создать новый шаблон, которого еще нет в базе данных - используйте ключ `--custom` в команде `xf-designer:touch-template`:

```$ php cmd.php xf-designer:touch-template test_style public:custom_tpl_test --custom
   
   Template 'public:custom_tpl_test' modified in style 'TestStyle'
```

Внимание! После выполнения этой команды шаблон будет создан в базе данных, но не будет выгружен в виде файла. Чтобы выгрузить его, используйте предыдущий вариант команды (без опции `--custom`).

Также обратите внимание, что регистр в названии шаблона имеет значение - как он назван в базе данных, так и нужно его выгружать, см. пример ниже:

```bash
php cmd.php xf-designer:touch-template test_style public:page_container                                                                                                                                                
The template 'public:page_container' does not exist in any style. Pass the --custom option to create it.
                                                                                                                                                                                                                            
php cmd.php xf-designer:touch-template test_style public:PAGE_CONTAINER                                                                                                                                                
Template 'public:PAGE_CONTAINER' modified in style 'test_style'
```

## Другие полезные команды

### Экспорт из базы данных

Обычно файлы шаблонов выгружаются автоматически при включении режима разработки для данного стиля, но бывают случаи или причины, когда файлы желательно выгрузить заново "с гарантией". Для этого используйте команду `xf-designer:export`:

```bash
$ php cmd.php xf-designer:export [designer_mode_id]
```

Эта команда поддерживает уточнение типа выгружаемых шаблонов, например `xf-designer:import-templates` выгрузит только шаблоны.

### Импорт из базы данных

Команда `xf-designer:import` загрузит (перезапишет) шаблоны из файлов в базу данных.

```bash
$ php cmd.php xf-designer:import [designer_mode_id]
```

Эта команда поддерживает уточнение типа загружаемых шаблонов, например `xf-designer:import-templates` загрузит только шаблоны.

### Синхронизация шаблонов

Команда `xf-designer:sync-templates` похожа на команду импорта шаблонов, но в отличие от нее, загружает только измененные шаблоны. Также коамнда обновит версии шаблонов.

```bash
$ php cmd.php xf-designer:sync-templates [designer_mode_id]
```

> Примечание переводчика: честно говоря, я пока не понял, как работает эта команда - после изменения конкретного файла оно все равно пишет `Done. Total templates updated: 0.`, и в базе данных шаблон остается неизменным.

### Вернуть шаблон

Команда `xf-designer:revert-template` используется для возвращения шаблонов к оригинальному виду (коду):

```bash
$ php cmd.php xf-designer:revert-template [designer_mode_id] [template_type:template_title]
```

Более простой способ - просто удалить файл шаблона, и автоматическое обновление вернет шаблон в базе данных к его первоначальному виду (коду).

## Ссылки

- [Оригинал статьи](https://github.com/xenforo-ltd/docs/blob/master/docs/designing-styles.md)